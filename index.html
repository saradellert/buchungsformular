<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Buchungsanfrage</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/de.js"></script>

<style>
body {
  font-family: 'Poppins', sans-serif;
  background: transparent;
  color: #292826;
  margin: 0;
  padding: 0;
}
form {
  max-width: 480px;
  margin: 0 auto;
  background: rgba(255,255,255,0.65);
  backdrop-filter: blur(10px);
  border-radius: 18px;
  padding: 2rem;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  position: relative;
}
h2 {
  font-weight: 600;
  font-size: 1.5rem;
  text-align: center;
  margin-bottom: 1.5rem;
}
label {
  display: block;
  margin-top: 1rem;
  font-weight: 500;
  font-size: 0.95rem;
}
input, select, textarea {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid #ccc;
  border-radius: 12px;
  font-size: 1rem;
  box-sizing: border-box;
  margin-top: 0.25rem;
  font-family: 'Poppins', sans-serif;
}
textarea { resize: none; }

/* Buttons - OPTIMIZED */
button {
  width: 100%;
  background: #292826;
  color: white;
  border: none;
  border-radius: 12px;
  padding: 0.9rem;
  font-size: 1rem;
  margin-top: 1.5rem;
  cursor: pointer;
  transition: transform 0.15s ease, background 0.2s ease;
  will-change: transform;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}
button:hover { 
  background: #3A3A36;
}
button:active {
  transform: scale(0.98);
}
button.loading {
  background: #44433F;
  cursor: wait;
  transform: scale(0.98);
}

/* Loading Spinner - NEW */
.spinner {
  width: 18px;
  height: 18px;
  border: 2px solid rgba(255,255,255,0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 0.6s linear infinite;
  display: none;
}
button.loading .spinner {
  display: block;
}
@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Adults counter */
.counter {
  display: flex;
  align-items: center;
  justify-content: space-between;
  border: 1px solid #ccc;
  border-radius: 12px;
  width: 160px;
  height: 48px;
  margin-top: 0.25rem;
  padding: 0 6px;
}
.counter button {
  width: 38px;
  height: 38px;
  border-radius: 10px;
  background: #f0f0f0;
  color: #292826;
  font-size: 1.3rem;
  font-weight: 600;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background 0.15s ease, transform 0.1s ease;
}
.counter button:hover { background: #e5e5e5; }
.counter button:active { transform: scale(0.95); }
.counter span {
  text-align: center;
  flex: 1;
  font-size: 1rem;
}

/* Haustier buttons */
.pet-buttons {
  display: flex;
  gap: 0.75rem;
  margin-top: 0.5rem;
}
.pet-buttons button {
  flex: 0 0 80px;
  background: #f0f0f0;
  color: #292826;
  border: 1px solid #ccc;
  border-radius: 20px;
  padding: 0.5rem 0;
  font-weight: 500;
  transition: all 0.15s ease;
}
.pet-buttons button:active {
  transform: scale(0.95);
}
.pet-buttons button.active {
  background: #292826;
  color: white;
  border-color: #292826;
}

/* Flatpickr */
.flatpickr-calendar {
  border-radius: 16px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}
#selectedRange {
  text-align: left;
  font-weight: 500;
  margin-top: 0.6rem;
  color: #3A3A36;
  padding-left: 0.25rem;
}

/* Overlay - OPTIMIZED */
#overlay {
  position: absolute;
  inset: 0;
  background: rgba(255,255,255,0.95);
  backdrop-filter: blur(8px);
  border-radius: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transform: scale(0.95);
  pointer-events: none;
  transition: opacity 0.25s ease, transform 0.25s ease;
  will-change: opacity, transform;
  text-align: center;
}
#overlay.active {
  opacity: 1;
  transform: scale(1);
  pointer-events: all;
}
#overlay p {
  font-size: 1.05rem;
  color: #292826;
  line-height: 1.5;
  animation: fadeInUp 0.4s ease;
}
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
</style>
</head>

<body>
<form id="bookingForm">
  <h2>Buchungsanfrage</h2>

  <label>Vor- und Nachname *</label>
  <input type="text" name="name" autocomplete="name" required />

  <label>Email *</label>
  <input type="email" name="email" autocomplete="email" required />

  <label>Telefonnummer *</label>
  <input type="tel" name="phone" autocomplete="tel" placeholder="+49 123 456789" required />

  <label>Wohnung *</label>
  <select name="apartment" required>
    <option value="">Wohnung auswählen</option>
    <option value="La Maison">La Maison</option>
    <option value="Maisonette Beach">Maisonette Beach</option>
    <option value="Suite Maritim">Suite Maritim</option>
    <option value="Malibu S">Malibu S</option>
    <option value="Malibu L">Malibu L</option>
    <option value="Cottage & Garden">Cottage & Garden</option>
  </select>

  <label>Zeitraum *</label>
  <div id="calendarContainer"></div>
  <div id="selectedRange">Bitte Zeitraum wählen</div>
  <input type="hidden" name="arrival" />
  <input type="hidden" name="departure" />

  <label>Anzahl Personen (Erwachsene)</label>
  <div class="counter">
    <button type="button" id="minusAdult">−</button>
    <span id="adultCount">1</span>
    <button type="button" id="plusAdult">+</button>
  </div>
  <input type="hidden" name="adults" value="1" />

  <label>Anzahl Kinder (bitte Alter angeben)</label>
  <input type="text" name="children" placeholder="z. B. 1 Kind (10 Jahre)" />

  <label>Haustier *</label>
  <div class="pet-buttons">
    <button type="button" data-value="Ja">Ja</button>
    <button type="button" data-value="Nein" class="active">Nein</button>
  </div>
  <input type="hidden" name="pet" value="Nein" />

  <label>Sonstiges</label>
  <textarea name="notes" rows="3" placeholder="Ihre Nachricht …"></textarea>

  <button type="submit" id="submitBtn">
    <span class="spinner"></span>
    <span id="btnText">Anfrage senden</span>
  </button>

  <div id="overlay"><p>Vielen Dank für Ihre Anfrage!<br>Sie erhalten in Kürze eine Bestätigung per E-Mail.</p></div>
</form>

<script>
flatpickr("#calendarContainer", {
  inline: true,
  mode: "range",
  locale: "de",
  dateFormat: "d.m.Y",
  onChange: function(selectedDates) {
    const range = document.getElementById("selectedRange");
    if (selectedDates.length === 2) {
      const [start, end] = selectedDates;
      const arrival = start.toLocaleDateString("de-DE");
      const departure = end.toLocaleDateString("de-DE");
      range.textContent = `Von ${arrival} bis ${departure}`;
      document.querySelector('input[name="arrival"]').value = arrival;
      document.querySelector('input[name="departure"]').value = departure;
    } else {
      range.textContent = "Bitte Zeitraum wählen";
    }
  }
});

let adults = 1;
const adultDisplay = document.getElementById("adultCount");
document.getElementById("plusAdult").onclick = () => {
  if (adults < 10) adults++;
  adultDisplay.textContent = adults;
  document.querySelector('input[name="adults"]').value = adults;
};
document.getElementById("minusAdult").onclick = () => {
  if (adults > 1) adults--;
  adultDisplay.textContent = adults;
  document.querySelector('input[name="adults"]').value = adults;
};

const petButtons = document.querySelectorAll(".pet-buttons button");
petButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    petButtons.forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    document.querySelector('input[name="pet"]').value = btn.dataset.value;
  });
});

document.getElementById("bookingForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const form = e.target;
  const data = Object.fromEntries(new FormData(form).entries());
  const btn = document.getElementById("submitBtn");
  const btnText = document.getElementById("btnText");
  const overlay = document.getElementById("overlay");

  // Immediate visual feedback
  btn.classList.add("loading");
  btn.disabled = true;
  btnText.textContent = "Wird gesendet …";

  try {
    const res = await fetch("https://script.google.com/macros/s/AKfycbzA9UOuNCaStraqAjEAtXfOKkG7d7PuJL-ObdaOzpyTxzMdESBSkZUi4xcalzm2clQ73Q/exec", {
      method: "POST",
      body: JSON.stringify(data)
    });
    
    if (res.ok) {
      // Show success overlay immediately
      overlay.classList.add("active");
      
      // Reset after delay
      setTimeout(() => {
        overlay.classList.remove("active");
        form.reset();
        adults = 1;
        adultDisplay.textContent = adults;
        document.getElementById("selectedRange").textContent = "Bitte Zeitraum wählen";
        btnText.textContent = "Anfrage senden";
        btn.classList.remove("loading");
        btn.disabled = false;
      }, 4000);
    } else {
      alert("Fehler beim Senden – bitte nochmal versuchen.");
      btnText.textContent = "Anfrage senden";
      btn.classList.remove("loading");
      btn.disabled = false;
    }
  } catch (err) {
    alert("Fehler: " + err.message);
    btnText.textContent = "Anfrage senden";
    btn.classList.remove("loading");
    btn.disabled = false;
  }
});
</script>
</body>
</html>
